const input = ['                                       M       I     A   Q     Z     Z   X     G   P                                           ','                                       F       A     F   U     I     Z   R     C   R                                           ','  #####################################.#######.#####.###.#####.#####.###.#####.###.#########################################  ','  #.........#.#.#...#...........#.#.#.......#.......#.#.....#.....#...#.....#.#...#.#.....#.........#.....#.......#.......#.#  ','  #.#####.###.#.###.#.###.#####.#.#.#######.###.#.###.#.#.###.###.###.#.###.#.#.###.#.#.###.###.###.###.#######.###.#.###.#.#  ','  #.#...#...#.#.........#.#.....#.....#.#.#...#.#...#...#...#...#...#...#.#.#...#.....#.......#.#...................#...#...#  ','  ###.###.###.###.###########.#.#####.#.#.#.#####.#.#######.###.#####.#.###.###.#######.#.#######.#.#.#######.#.#.#####.###.#  ','  #...#.#...........#.........#...#.......#...#...#.#.......#.....#...#.#...#.#...#...#.#.#...#...#.#...#.#.#.#.#.....#...#.#  ','  ###.#.#.#####################.#####.###.#.#####.#####.#.###.#############.#.###.#.#.###.#.###.#####.###.#.###.###.#########  ','  #.........#...#.#...#.#.#.......#...#.#.....#.....#...#.#...#...#.......#.#.....#.#.........#.#.#...#.......#.#.....#...#.#  ','  #.###########.#.###.#.#.#.#####.###.###.#.#.#.###.#.#######.#.#####.###.#.###.###.###.#.#.#####.###.#####.###.#########.#.#  ','  #.....#...#...#...........#.........#.#.#.#.#.#...#...#.#.#...#.#.....#...#.....#...#.#.#.......#.....#...#.#.....#.#.#.#.#  ','  #.#######.#.#.#####.#.###.#####.#.#.#.###########.#.###.#.###.#.###.#.#####.#####.#.#####.#.###.#######.###.#######.#.#.#.#  ','  #.#.......#.#...#...#.#...#...#.#.#.#.....#.#.....#.....#.......#...#.....#.....#.#.#.#.#.#.#.....#...#...#.#.#.#.........#  ','  #####.#######.#####.#######.#.#.###.#.#####.###.#.#.#######.###.#####.#.#.###.#.#.###.#.#############.#.###.#.#.#.#######.#  ','  #.........#.....#.#.#.#...#.#.....#.....#.#.....#.#.#...#...#.......#.#.#.#...#.#...#...#.....#.......#.............#...#.#  ','  #.#.###.###.#.#.#.###.###.###.#####.#####.###.###.#.###.###.###.#######.#.###.#.#.#####.#.#####.#######.#.#####.#.###.#####  ','  #.#.#.....#.#.#.#.#.....#.......#.#...#.....#...#.#...#.......#...#.....#.#...#.#...........#.#.....#...#.#...#.#...#.#...#  ','  #######.#######.#.###.###.#.#.###.###.#.###.#####.#.#.#####.#########.###.#.#####.###.###.###.#.#######.###.#######.#.###.#  ','  #.#.....#...#...#...#...#.#.#...#.#.....#.#.#.....#.#.#.....#.......#.#...#.....#...#.#...........#.#.......#...#.....#...#  ','  #.#####.###.#.#####.#.###.#######.#.#.#.#.#.#.###.#.#######.###.#########.###.###.###.#####.#.###.#.#.#.#####.#####.#####.#  ','  #.#.#...#.#.....#.#.....#.#.#.#.#...#.#...#.#.#.#.#.#.....#.#.....#.....#.#...#.....#.....#.#.#.#.....#...#.#.#...#.#...#.#  ','  #.#.###.#.#####.#.###.#####.#.#.###.###.#######.#.#.#.#.###.###.#####.###.#.#####.#############.###.#.#####.#.###.###.###.#  ','  #.#.....#.#.............#...#.....#.#...#.........#.#.#.#.#.......#.#.#...#.#.#...#.#.......#.....#.#.......#...#...#.#...#  ','  #.###.#.#.#.#####.#.#.#####.###.#.#.#######.#####.#.###.#.###.#.###.#.###.#.#.###.#.###.###.###.###.#########.###.###.###.#  ','  #...#.#...#.#...#.#.#...#.#.....#.....#...#.#.....#.#...#.#...#...#.#.....#.#.#...........#.....#.#...#.....#.#.......#.#.#  ','  ###.###.#.#####.###.###.#.#######.#.#####.###.#####.#.#.#.#######.#.#.###.#.#.#####.#.#######.###.#.###.#####.###.#.###.#.#  ','  #.......#.#.......#.#...#...#.....#...#.........#.#.#.#.......#...#.....#.#.....#.#.#.......#...#.#.#.#...#.#.....#.#...#.#  ','  #.#.#.#######.#.#.###.###.#########.#######.###.#.#.#.###.#.#.###.#.#########.###.#.###.#####.###.###.###.#.#####.###.###.#  ','  #.#.#.#.#...#.#.#...#.#.#...#...#.#.#.#.......#.#...#...#.#.#.#...#.....#.#...#.#...#...#...#...#...#.#.#.....#...#...#...#  ','  #####.#.#.#######.###.#.###.#.###.#.#.#####.#######.###.#.#####.#.#.#####.#.###.#.#######.#.#####.###.#.#.###.###.#.#####.#  ','  #.......#...#.#...#...#.#.............#.......#...#.#...#.#...#.#.#.....#.....#...........#...#.#.#.#.......#.#.....#.#...#  ','  #####.#.#.###.###.#.###.#####.#.###.#.#####.#.#.###.#.###.###.#.###.#######.#####.###.#.#######.#.#.#####.#######.###.#.#.#  ','  #.#...#...#.#.........#.#.....#.#...#...#...#...#.....#...#.......#.....#.......#.#...#.#.......#...#...#.....#.......#.#.#  ','  #.#.#.#####.#####.#####.###.#.#######.#######.#####.###.#####.#########.###.#########.#####.#######.#.###.#######.#######.#  ','  #.#.#...#...#.#.....#.#.#...#.#.#    Q       I     G   B     G         T   H         L    #...#.#.......#.....#.#...#.....#  ','  #.###.###.#.#.#####.#.#.#######.#    U       Q     O   V     C         X   P         N    #.###.###.#####.#.###.#.#.###.###  ','IQ........#.#.#.#...#.#...#.#.#.#.#                                                         #...#.#...#.#...#.#.#...#.#...#.#  ',
'  ###.#####.###.###.#.#.###.#.#.#.#                                                         #.###.###.#.###.###.###.#.###.#.#  ','  #.....#.......#.#.....#...#...#..VI                                                     XR........................#.#.#...#  ','  #.###.#.#####.#.#.###.#.#.#.#.#.#                                                         #.###.#.###.#####.#.#######.#.#.#  ','  #.#.#.....#.........#...#...#...#                                                         #...#.#...#...#.#.#.....#.#.#.#.#  ','  ###.###########.#####.###.#######                                                         #.###.#########.###.#####.#.#.#.#  ','GD......#.#.....#.....#.#.#...#...#                                                         #.#.#.....#.....#...#.....#.#.#.#  ','  ###.###.###.#####.#####.#####.#.#                                                         ###.#########.#.###.#.#.#.#.#.#.#  ','  #.......#.......#.#.....#.....#.#                                                         #...#.#.#.#.#.#.#.....#.#.....#..OU','  #####.#####.#.#####.#######.#.#.#                                                         ###.#.#.#.#.#.###########.#######  ','  #.....#.#.#.#...#.....#.#.#.#.#..HN                                                       #.......................#.#...#..VI','  ###.###.#.#.###.#.#.###.#.###.#.#                                                         ###.#######.###.###.#.#.###.#.#.#  ','  #.#...........#...#...........#.#                                                         #...#...#.....#.#...#.#.#.#.#...#  ','  #.###############.###############                                                         ###.#.###.#.###.###.#####.#.#.###  ','YC....#...#.......#.#.#.#...#.#.#.#                                                         #.......#.#.#...#...#.......#.#.#  ','  #.###.#.###.###.###.#.###.#.#.#.#                                                         #####.#.#######.###.#.###.#.###.#  ','  #.....#.......#..................IA                                                     GD......#.#.#.....#.#...#.#.#...#.#  ','  #################################                                                         #########.#######.#####.#######.#  ','  #.#.......#...............#.....#                                                       MF..........#.............#.......#  ','  #.#.###.#.#.###.###.#.###.#.###.#                                                         #.#######.#.#####.#.###.#####.#.#  ','  #.....#.#.#...#.#...#...#.....#.#                                                         #.#.#...#.#.#.#.#.#.#.#...#...#.#  ','  #.#######.#.###.#.#.#####.#####.#                                                         #.#.#####.#.#.#.#####.###.#.#.#.#  ','  #.....#...#...#.#.#.#.......#...#                                                         #...#.....#...#...#.......#.#.#..DM','  ###.###.#.#.###################.#                                                         #.#.#.#######.#.###.#.#######.#.#  ','TX....#.#.#...#...#.#.#.......#....ZI                                                       #.#.#...........#...#.........#.#  ','  #####.#########.#.#.#.###.#####.#                                                         #.#####.#.#####.#################  ','  #...........#.......#.#.......#.#                                                         #.#.#.#.#.#...#.#................AA','  #.###.#.###.#.#####.###.###.#####                                                         ###.#.#.###.#.###.#.###########.#  ','  #.#.#.#.#...#...#...#.....#.....#                                                         #...#.#.#...#.....#...........#.#  ','  #.#.#######.#.#####.#####.###.###                                                         ###.#.#####.###.#.#.###.#.#.#.###  ','  #...#...#.........#.#...#.#.....#                                                         #.......#...#.#.#.#...#.#.#.#....VD','  #.#####.###.#######.#.#.#.#.#####                                                         #.###.#####.#.#####.#############  ','HN..#...#.#.......#.....#...#......AF                                                     DM....#.........#.......#.....#.#.#  ','  ###.###.###########.#.###.#.#####                                                         #######################.#####.#.#  ','  #...............#.#.#.#.#.#...#.#                                                         #...#.............#.............#  ','  ###.#######.###.#.#####.#######.#                                                         #.#.#.#######.#########.#.###.###  ','UV..#...#.#...#...#...............#                                                         #.#.#.....#.........#.#.#...#....GO','  #.#.###.#.#########.###.#######.#                                                         #.#.#.#######.###.###.#.#.#.###.#  ','  #.....#.......#.......#...#...#.#                                                         #.#.#...#.#...#.#.......#.#.#...#  ',
'  #.#.###.#.###.###.###.#.#.###.#.#                                                         #.#.#.###.#####.#.###.#.#######.#  ','  #.#...#.#...#.....#.#.#.#.#......XA                                                     PR..#.....#.#...#.#...#.#.#...#.#.#  ','  #############.###.#.#######.#.###                                                         #########.#.#.#.#######.###.#.###  ','  #.#.........#.#.#.#.#.....#.#.#.#                                                       VD..#.........#.#.....#.#...#.#...#  ','  #.#####.#.#####.###.#####.#####.#                                                         #.#.#.#####.###.###.#.#####.#.#.#  ','XA..#.....#...#...#...#.#.#.#.#.#..YY                                                       #.#.#.#.........#.....#.......#..UD','  #.###.###.###.###.###.#.#.#.#.#.#                                                         #.#.#######.#.#.###.###.#######.#  ','  #.......#.#...#...#...#.....#...#                                                         #.#.....#...#.#.#...........#...#  ','  #.###.###.#.#.#.#.#.#.#.###.#.#.#                                                         #.#.#####.###.#####.###.#######.#  ','  #...#...#...#...#...#.....#...#.#                                                         #.....#...#.....#...#.#...#.#...#  ','  #.###.###.###.#.#.###.###.###.###        U           V   Q       O     U       Y          #.#.#.###.###.#####.#.#.###.#####  ','  #.#...#.....#.#.#.#.#...#.#...#.#        V           J   D       U     D       C          #.#.#.#.....#.#.#.....#.........#  ','  #.#######.###.#.###.#.#.#.###.#.#########.###########.###.#######.#####.#######.###########.#######.#.###.#.#####.#####.#.#  ','  #.....#...#...#.#.....#.#.#.........#.#.#.....#.........#.#.#.....#...#.......#.#.........#.....#...#.....#...#.....#...#.#  ','  ###.#####.###.#.###.#.#######.###.###.#.#.###.#.#########.#.###.#.#.#.#####.###.#####.###.#########.###.#######.###.#######  ','  #.....#.#...#.#.#...#.#.#.....#...#.........#.#.........#.....#.#.#.#.#.....#.#...#.....#...#.........#...#.....#.........#  ','  ###.#.#.#.###.###.#.#.#.#####.###.###.###.###.#######.###.#.#.#.###.#.#.#####.#.#####.###########.#.###.#.#.###.#####.###.#  ','  #.#.#...#...#...#.#.#.#.#.......#.#...#...#...#.........#.#.#.#.....#.#.......#.....#.#.#.......#.#...#.#.#.#.#.#.....#...#  ','  #.###.###.###.#####.###.###.###.#####.#####.###.###.#####.###.#.###.#.###.###.#.#####.#.#.#########.#######.#.###.#.#####.#  ','  #.......#...#...#...#.........#.#.#.....#.#...#.#.#.#.....#...#.#.#.#...#...#.#.........#.......#.....#.#.......#.#.#.....#  ','  #.###.#.#######.###.#####.#######.#####.#.#.###.#.#.#.#####.#####.###.#######.#.#####.#.#.#########.#.#.###.#######.#####.#  ','  #.#...#...#.......#.#.......#.........#.#.....#...#.#.#.....#...#...#...#.....#...#...#...#.#...#...#...#.#.....#.......#.#  ','  #####.###.#####.#.###.###.#########.#####.###.###.#.###.#.#.###.#.###.#.#.#####.#.###.###.#.#.#####.#####.#.#.###.#.#.#.#.#  ','  #...#...#...#...#.#...#.......#.....#...#.#...#...#...#.#.#...#.....#.#.#.....#.#...#.#.#.........#...#.....#.#...#.#.#.#.#  ','  ###.#.###.###.#.###.###.#.#.#.#####.#.#######.#.#############.#####.#.###.###.#.#.#####.###################.#####.###.#.###  ','  #.....#...#.#.#...#.#...#.#.#.....#.....#.....#...#.....#.......#.......#.#...#.#.#...................#.......#.....#.#...#  ','  #####.#####.###########.#.#########.#.#######.#.#####.#####.#######.#.#####.###.#####.#######.#########.###.###########.#.#  ','  #.........#...#.........#...#.......#.#.#.#...#.#.....#...#...#.....#.#.......#.#.#.....#...#.........#.#.......#.#.....#.#  ','  ###.#.#######.###.#.#.###.###.###.###.#.#.#.###.###.###.#####.#####.#########.#.#.#.#####.#######.#.#######.###.#.###.#.#.#  ','  #...#.#...........#.#.#...#.....#.#.......#...#.......#.#...#...#.......#.#.#.#.............#.....#.#...#.....#.#.....#.#.#  ','  #.#.#######.###########.###.#######.###.#.###.#.###.###.###.#.###.#.#####.#.#.#######.###.###########.#####.#.#####.#.#.###  ','  #.#...#.....#.#...#...#...#.#...#.#...#.#.....#.#.#.#.........#.#.#...#.......#.#.#...#.........#.#.....#...#...#...#.#...#  ','  #.#.#####.#.#.###.###.#########.#.#####.#######.#.#####.#######.#####.#######.#.#.###.###.###.#.#.###.#.###########.###.###  ','  #.#...#...#...#.........#.#...#.#...#.......#.....#.....#.....#...#.....#...#.#.....#.#.....#.#...#...#.#...#...#.....#...#  ','  #.###.###.#.#####.#####.#.###.#.#.#.###.###.###.#.#####.#.###.#.#.#.#####.###.#.###.#.###.#######.###.#####.#.#####.###.#.#  ','  #...#...#.#.#.#...#.............#.#.....#.....#.#.#.....#.#.#.#.#.#.......#...#.#.#.#...#.#...#.....#...#.#.......#...#.#.#  ','  ###.###.#####.#.###############.###.#########.#.#####.#.#.#.#.#.#.###.#.###.###.#.#.#.#####.#######.#.###.#.#####.#.###.#.#  ','  #...#...#.......#.......#.....#.....#.....#.#.#.....#.#.#.#.#.#.#...#.#.#.....#...#.......#.#...#...............#.#.#.#.#.#  ',
'  #.#######.#######.#.#.#####.#.#.#.#####.#.#.#.#.###.###.#.#.#.#.###.#.#######.#.#.###.###.#.#.#####.#.###.###.#######.###.#  ','  #.#.#...#...#.....#.#.......#...#...#...#.....#.#.#.#.#...#.#.#...#.#.....#.#.#.#...#...#.......#...#...#...#...........#.#  ','  ###.###.#.#.###.#####.#.#.#####.#.###.###.###.###.#.#.#.#.###.###.#.#.###.#.#.#####.#.#####.###.###.###.###.#.###.#######.#  ','  #.........#.#...#.#.#.#.#.#.....#...#...#.#...#...#...#.#...#.#...#.....#.#.......#.#...#.....#...#.#.#.#...#.#.........#.#  ','  #.###.#.#.#####.#.#.#.#.###.#######.#.###.###.###.###.#######.#.#############.#####.#########.###.#.#.###.###.#.#####.#.###  ','  #.#...#.#...#...#.....#.#.....#.....#.#.....#.#.......#.......#.......#.........#.........#.....#.#...#...#...#.....#.#...#  ','  ###########################################.#####.#######.#########.#######.#######.#######################################  ','                                             V     B       H         Y       L       Q                                         ','                                             J     V       P         Y       N       D                                         '];

function sleep(ms){
  return new Promise(resolve=>{
      setTimeout(resolve,ms)
  })
}

let simulate = false;

async function day20() {
  const map = input.map((r) => {
    return r.split('');
  })
  const posToLabelMap = {};
  const labelToPosMap = {};
  let robotPos, labelStr;
  for (let r = 0; r < input.length; r++) {
    for (let c = 0; c < input[0].length; c++) {
      if (input[r][c] === '#' || input[r][c] === ' ' || input[r][c] === '.') {
        continue;
      }
      let labelPos; // the dot nearest to the label
      if (r < input.length - 1 && input[r+1][c] !== '#' && input[r+1][c] !== ' ' && input[r+1][c] !== '.') {
        labelStr = `${input[r][c]}${input[r+1][c]}`;
        // it's vertical - save it either above or below
        if (r < input.length - 2 && input[r+2][c] === '.') {
          labelPos = [r+2,c];
        } else if (r > 0 && input[r-1][c] === '.') {
          labelPos = [r-1,c];
        } else {
          console.log(`somehow a verical label is not adjacent to a . - ${input[r][c]}${input[r+1][c]}`);
        }
      } else if (c < input[0].length - 1 && input[r][c+1] !== '#' && input[r][c+1] !== ' ' && input[r][c+1] !== '.') {
        labelStr = `${input[r][c]}${input[r][c+1]}`;
        // it's horizontal - save it either left or right
        if (c < input[0].length - 2 && input[r][c+2] === '.') {
          labelPos = [r,c+2];
        } else if (c > 0 && input[r][c-1] === '.') {
          labelPos = [r,c-1];
        } else {
          console.log(`somehow a horizontal label is not adjacent to a . - ${input[r][c]}${input[r][c+1]}`);
        }
      }
      if (!labelPos) {
        continue;
      }
      let labelPosKey = `${labelPos[0]},${labelPos[1]}`;
      posToLabelMap[labelPosKey] = labelStr;
      if (!labelToPosMap[labelStr]) {
        labelToPosMap[labelStr] = [];
      }
      labelToPosMap[labelStr].push([...labelPos]);
      if (labelStr === 'AA') {
        robotPos = [...labelPos,0];
      }
    }
  }
  map[robotPos[0]][robotPos[1]] = '^';

  function print() {
    map.forEach((r) => {
      console.log(r.join(''));
    })
  }

  print();
  const nextSteps = [robotPos];
  while(nextSteps.length > 0) {
    const step = nextSteps.shift();
    if (step[0] > 0 && map[step[0]-1][step[1]] === '.') {
      nextSteps.push([step[0]-1, step[1], step[2]+1]);
      map[step[0]-1][step[1]] = (step[2] + 1) % 10;
    }
    if (step[0] < map.length-1 && map[step[0]+1][step[1]] === '.') {
      nextSteps.push([step[0]+1, step[1], step[2]+1]);
      map[step[0]+1][step[1]] = (step[2] + 1) % 10;
    }
    if (step[1] > 0 && map[step[0]][step[1]-1] === '.') {
      nextSteps.push([step[0], step[1]-1, step[2]+1]);
      map[step[0]][step[1]-1] = (step[2] + 1) % 10;
    }
    if (step[1] < map[0].length-1 && map[step[0]][step[1]+1] === '.') {
      nextSteps.push([step[0], step[1]+1, step[2]+1]);
      map[step[0]][step[1]+1] = (step[2] + 1) % 10;
    }
    const label = posToLabelMap[`${step[0]},${step[1]}`];
    if (label === 'ZZ') {
      print();
      console.log(`ZZ reached in ${step[2]} steps`);
      return;
    } else if (label && label !== 'AA') {
      const portals = labelToPosMap[label];
      let otherPortal = portals[0];
      if (portals[0][0] === step[0] && portals[0][1] === step[1]) {
        otherPortal = portals[1];
      }
      nextSteps.push([otherPortal[0], otherPortal[1], step[2]+1]);
      map[otherPortal[0]][otherPortal[1]] = (step[2] + 1) % 10;
    }
    if (simulate) {
      print();
      await sleep(100);
    }
  }
}
// simulate = true;
day20();